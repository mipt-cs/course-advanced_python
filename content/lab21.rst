Создание Web сайтов на Python. Основы flask и HTML
##################################################

:date: 2021-03-16 09:00
:summary: Введение в flask и HTML
:status: draft

.. default-role:: code

.. contents:: Содержание

.. role:: python(code)
   :language: python

.. role:: bash(code)
   :language: bash

.. raw:: html

    <style>
    td, th{
        border-style:dashed solid;
        border-width:1px;
        border-color:rgba(0,0,0,0.5);
    }
    </style>


Введение
--------

Для создания веб сайта с «нуля» на сокетах необходимо проделать огромный пласт не особо нужной работы.
В связи с этим, при разработки сайтов гораздо проще и правильнее использовать уже написанный ранее
инструментарий для создания сайтов. На python — это фреймворки для создания веб-приложений `django`__  и `flask`__

.. __: https://www.djangoproject.com/
.. __: https://palletsprojects.com/p/flask/

`django` представляет из себя громоздкий фреймворк, в то время как `flask` является микрофреймворком,
 позволяющий создавать как маленькие простые, так и достаточно громоздкие интернет сайты.
 Введение в программирование сайтов на flask и будет приведено в данном уроке.

Введение в flask
----------------

Пустой простой сайт на flask
============================

.. code:: python

    import flask

    app = flask.Flask(__name__)

    #Здесь будем дописывать сайт

    # Добавим возможность "запуска файла"
    if __name__ == "__main__":
        app.run(debug = True)

**Не используйте для работы с flask файл с именем flask.py**

Запуск сайта на flask
=====================

.. code:: bash

    $ cd <flask application directory>
    $ export FLASK_APP=<app_filename.py>
    $ export FLASK_DEBUG=1
    $ flask run

..

    *На Windows необходимо использовать set вместо export*

После запуска перейдите на http://127.0.0.1:5000/ и увидите

.. raw:: html

    <div style="background-color:white"><h1>Not Found</h1>
    <p>The requested URL was not found on the server.  If you entered the URL manually please check your spelling and try again.</p>
    </div>

Что ожидаемо, поскольку сайт пуст.

Добавление главной страницы
===========================

Создадим главную страницу в нашем сайте (обычно запрашивается по `/` или `/index.html`):

.. code:: python

    @app.route('/')
    @app.route('/index.html')
    def index_page():
        return 'Это главная Страница сайта'

Обновив страницу, вы увидите ,обозначенный выше, текст.

Понятно, что каждый раз генерировать `html` целиком страницу, осуществлять передачу файлов
и осуществлять другие стандартные действия ‒ лишняя работа, уже реализованная в flask.

Структура web приложения на flask:
==================================

При создании приложения на flask необходимо сразу организовать файловую структуру. Пример

.. code:: text

    flask_demo
    ├── flask_app
    │   ├── config_base.py
    │   ├── __init__.py
    │   ├── static
    │   │   └── css
    │   │       └── base.css
    │   └── templates
    │       └── index.html
    ├── instance
    │   └── config.py
    └── run.sh

Здесь:

* `flask_demo` ‒ Папка со всей информацией о сайте
* `flask_app` ‒ Папка, содержащая непосредственно сайт: изменения в данной папке стоит фиксировать git-ом
* `config_base.py` ‒ файл примера настроек сайта
* `__init__.py` — Главный файл сайта на flask
* `static` — Папка со статичными файлами (`css`, `js`, `pdf`, `zip`, прочие)
* `css` — Статичная папка для хранения стилевых файлов (`см. далее <css_>`_)
* `base.css` — Базовый стилевой файл (`см. далее <css_>`_)
* `templates` — Папка шаблонов страниц сайта (`см. далее <html_>`_)
* `index.html` — шаблон главной страницы
* `instance` ‒ Папка «текущего» сайта: на вашем компьютере содержит различные отладочные данные, на рабочем сервере содержит рабочие реальные данные
* `config.py` — настройки «текущего» сайта
* `run.sh` — Файл запуска сайта

Пример Вы можете скачать `здесь`__

.. __: {filename}/extra/lab19/flask_example.zip

Рассмотрим его внимательнее.

Файл __init__.py
----------------

.. code:: python

    import flask


    def create_app():
        '''
        Function: create_app
        Summary: Создание flask приложения
        '''

        app = flask.Flask(__name__,
                          instance_relative_config=True,
                          template_folder="templates",
                          static_folder="static")

        # загружаем настройки
        app.config.from_pyfile('config.py', silent=False)

        # Главная страница сайта
        @app.route('/')
        @app.route('/index.html')
        def index_page():
            return flask.render_template('index.html', var="some data")

        return app

Как Вы видите, файл содержит только `create_app` — функцию, по созданию flask приложения.

**Отдельно рассмотрим строчку**

.. code:: python

    app = flask.Flask(__name__,
                  instance_relative_config=True,
                  template_folder="templates",
                  static_folder="static")

Здесь происходит создание пустого `flask` приложения, с указанием:

* `instance_relative_config` — Настройки сайта располагаются в папке `instance`
* `template_folder` — указание имени папки с шаблонами страниц. По умолчанию равно `"templates"` и может не задаваться
* `static_folder` — указание имени папки со статичными файлами. По умолчанию равно `"static"` и может не задаваться

Теперь же рассмотрим строчку

.. code:: python

    return flask.render_template('index.html', var="some data")

Тут происходит возвращение шаблона `index.html` из папки с шаблонами в установкой параметра `var` в `"some data"`.
Имена и количество передаваемых параметров определяете самостоятельно.

.. _html:

Введение в HTML
---------------

Изучим содержание шаблонного файла `index.html`

.. code:: html

    <!DOCTYPE html>
    <HTML>
    <HEAD>
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/base.css') }}">
        <TITLE> Мой сайт на flask </TITLE>
    </HEAD>
    <BODY>
        Текст на первой странице
    </BODY>
    </HTML>


В первой строке расположена «особая» запись, поясняющая браузеру, что разметка страницы произведена на языке HTML 5. Сейчас заниматься изучением старых версий разметки (в том числе XHTML) не имеет смысла, в силу их неактуальности. Однако, лучше сообщить браузеру информацию, что Вы используете именно пятую версию HTML.

.. code:: html

    <!DOCTYPE html>


Далее идёт блок непосредственно всей страницы, окаймлённый открывающим `<HTML>` и закрывающим `</HTML>` **тегами**.

.. code:: html

    <HTML>
        …
    </HTML>

Вся страница делиться на голову, содержащую различную вспомогательную информацию о странице,

.. code:: html

    <HEAD>
        …
    </HEAD>

и тело, внутри которого располагается содержимое страницы

.. code:: html

    <BODY>
        …
    </BODY>

Заголовок сайта (печатается на вкладке браузера)

.. code:: html

    <TITLE> Мой сайт на flask </TITLE>

Подключение таблицы стилей (см. ниже) при помощи тега, не требующего закрытия, и с тремя параметрами `rel`, `type` и `href`:

.. code:: html

    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/base.css') }}">

Конструкция `{{ url_for('static', filename='css/base.css') }}` даёт понять «отрисовщику» шаблона,
что на данное место сайта необходимо вставить результат работы python функции `url_for` (находиться в модуле `flask`).
Данная функция возвращает адрес статического (`static`) файла `css/base.css`.

По аналогии с этим, конструкция `{{ var }}` вставит в сайт значение `var`, переданное функции `render_template`
как именованный параметр.

Некоторые HTML теги
========================

Ниже будет приведена таблица HTML тегов. В ней:

1. **Тег** — название тега
2. **З** — вид тега
    I. ⧾ — тег необходимо открыть (`<тег>`) и закрыть (`</тег>`)
    II. ⧿ — тег закрывать не надо
3. **Параметры** — некоторые параметры тега

.. class:: mikl

+-------------+---+------------------------------------------+----------------------------------+
|     Тэг     | З |                 Описание                 |            параметры             |
+=============+===+==========================================+==================================+
| `HTML`      | ⧾ | Основной тег содержания сайта            |                                  |
+-------------+---+------------------------------------------+----------------------------------+
| `HEAD`      | ⧾ | Заголовок сайта                          |                                  |
+-------------+---+------------------------------------------+----------------------------------+
| `BODY`      | ⧾ | Основное содержание страницы             | `bgcolor` ‒ фон страницы         |
|             |   |                                          |                                  |
|             |   |                                          | `text` ‒ цвет текста             |
+-------------+---+------------------------------------------+----------------------------------+
| `P`         | ⧾ | «абзац»                                  | `align` ‒ выравнивание текста    |
+-------------+---+------------------------------------------+----------------------------------+
| `A`         | ⧾ | Гиперссылка                              | `href` ‒ адрес гиперссылки       |
+-------------+---+------------------------------------------+----------------------------------+
| `IMG`       | ⧿ | Вставка картинки                         | `src` ‒ адрес картинки           |
|             |   |                                          |                                  |
|             |   |                                          | `alt` ‒ описание картинки        |
+-------------+---+------------------------------------------+----------------------------------+
| `BR`        | ⧿ | Разрыв строки                            |                                  |
+-------------+---+------------------------------------------+----------------------------------+
| `HR`        | ⧿ | Разрыв строки горизонтальной линией      | `color` ‒ цвет                   |
|             |   |                                          |                                  |
|             |   |                                          | `size` ‒ толщина                 |
|             |   |                                          |                                  |
|             |   |                                          | `width` ‒ ширина                 |
+-------------+---+------------------------------------------+----------------------------------+
| `SPAN`      | ⧾ | Сам по себе ничего не делает,            |                                  |
|             |   | используется для пометки текстов         |                                  |
+-------------+---+------------------------------------------+----------------------------------+
| `DIV`       | ⧾ | Выделяет блок                            | `align`                          |
+-------------+---+------------------------------------------+----------------------------------+
| `STYLE`     | ⧾ | Определение стилей (`см. далее <css_>`_) |                                  |
+-------------+---+------------------------------------------+----------------------------------+
| `H1` – `H6` | ⧾ | Определяет заголовок 1 – 6 уровня        | `align`                          |
+-------------+---+------------------------------------------+----------------------------------+
| `UL`        | ⧾ | Маркированный список                     | `type` ‒ вид маркера             |
|             |   |                                          |                                  |
|             |   |                                          | `disc` •, `circle` ◦, `square` ▪ |
+-------------+---+------------------------------------------+----------------------------------+
| `OL`        | ⧾ | Нумерованный список                      | `type` ‒ вид маркера             |
|             |   |                                          | (`A, a, I, i, 1`)                |
|             |   |                                          |                                  |
|             |   |                                          | `reversed` ‒ убывание            |
|             |   |                                          |                                  |
|             |   |                                          | `start` ‒ стартовый номер        |
+-------------+---+------------------------------------------+----------------------------------+
| `LI`        | ⧾ | Элемент списка `UL` и `OL`               | `type`, `start`                  |
+-------------+---+------------------------------------------+----------------------------------+
| `B`         | ⧾ | **жирный** текст                         |                                  |
+-------------+---+------------------------------------------+----------------------------------+
| `i`         | ⧾ | *наклонный*                              |                                  |
+-------------+---+------------------------------------------+----------------------------------+
| `U`         | ⧾ | подчёркнутый                             |                                  |
+-------------+---+------------------------------------------+----------------------------------+
| `TABLE`     | ⧾ | Таблица                                  | `cellpadding` ‒ Отступ от        |
|             |   |                                          | рамки до содержимого ячейки.     |
|             |   |                                          |                                  |
|             |   |                                          | `cellspacing` ‒ Расстояние       |
|             |   |                                          | между ячейками.                  |
+-------------+---+------------------------------------------+----------------------------------+
| `TR`        | ⧾ | Строка таблицы                           | `align`, `bgcolor`               |
+-------------+---+------------------------------------------+----------------------------------+
| `TD`        | ⧾ | Ячейка таблицы                           | `align`, `bgcolor`               |
+-------------+---+------------------------------------------+----------------------------------+


Параметры, которые можно использовать в любом теге:

+----------+---------------------------------------------------------------+
| Параметр |                            Описание                           |
+==========+===============================================================+
| style    | изменение стиля (`см. далее <css_>`_) тега                    |
+----------+---------------------------------------------------------------+
| id       | определение идентификатора (подразумевается, что он уникален) |
+----------+---------------------------------------------------------------+
| class    | определение принадлежности классу                             |
+----------+---------------------------------------------------------------+

Больше тегов и их параметры можно посмотреть здесь__

.. __: http://htmlbook.ru/html/

.. _css:

CSS (каскадные таблицы стилей)
==============================

HTML позволяет определять стили для любых тегов.
Использование стилей позволяет изменять поведение и отображение тегов до неузнаваемости.
Определять стиль можно:
#. Внутри тега `STYLE`;
#. В отдельном `css` файле;
#. Внутри тега через параметр `style`.

Принцип определения стиля в отдельном файле совпадает с определением внутри тега `STYLE`

Пример:

.. code:: html

    <!-- определим свои стили -->
    <style>
    /* Так выглядят комментарии здесь */
    a
    /*
        далее внутри фигурных скобок
        определяем стиль для тега "a"
    */
    {
        color: white; /* определяем цвет текста - белый */
        background-color: rgba(255, 127, 0, 0.5);
            /*
                цвет фона по составляющим:
                   красный - 255 (максимум)
                   зелёный - 127
                   синий - 0 (минимум)
                   прозрачность - 50%
            */
    }

    .red_text /* определяем стиль для класса "red_text" */
    {
        color: rgb(255,0,0);
    }
    .blue_text{

    }
    .red_text, .blue_text /* определяем стиль для двух классов */
    {
        text-shadow: 5px -10px 2px black; /* добавляем тексту тень */
        padding: 5px; /* внутренний отступ от границ */
    }
    </style>

    Тут <a href="?">ссылка на текущую страницу</a>.
    А тут — <span class="red_text">красный текст</span>.
    Это — <a href="?" class="red_text">красная ссылка </a>.
    Здесь <span style="font-size:2em">Определяем стиль внути тега</span>.

Результат:

.. raw:: html

    <iframe style="width:100%;background-color:white;" src="data:text/html;base64,PG1ldGEgY2hhcnNldD0idXRmOCIvPgo8IS0tINC+0L/RgNC10LTQtdC70LjQvCDRgdCy0L7QuCDRgdGC0LjQu9C4IC0tPgogICAgPHN0eWxlPgogICAgLyog0KLQsNC6INCy0YvQs9C70Y/QtNGP0YIg0LrQvtC80LzQtdC90YLQsNGA0LjQuCDQt9C00LXRgdGMICovCiAgICBhCiAgICAvKgogICAgICAgINC00LDQu9C10LUg0LLQvdGD0YLRgNC4INGE0LjQs9GD0YDQvdGL0YUg0YHQutC+0LHQvtC6CiAgICAgICAg0L7Qv9GA0LXQtNC10LvRj9C10Lwg0YHRgtC40LvRjCDQtNC70Y8g0YLQtdCz0LAgInNwYW4iCiAgICAqLwogICAgewogICAgICAgIGNvbG9yOiB3aGl0ZTsgLyog0L7Qv9GA0LXQtNC10LvRj9C10Lwg0YbQstC10YIg0YLQtdC60YHRgtCwIC0g0LHQtdC70YvQuSAqLwogICAgICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMjU1LCAxMjcsIDAsIDAuNSk7CiAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICDRhtCy0LXRgiDRhNC+0L3QsCDQv9C+INGB0L7RgdGC0LDQstC70Y/RjtGJ0LjQvDoKICAgICAgICAgICAgICAgICAgINC60YDQsNGB0L3Ri9C5IC0gMjU1ICjQvNCw0LrRgdC40LzRg9C8KQogICAgICAgICAgICAgICAgICAg0LfQtdC70ZHQvdGL0LkgLSAxMjcKICAgICAgICAgICAgICAgICAgINGB0LjQvdC40LkgLSAwICjQvNC40L3QuNC80YPQvCkKICAgICAgICAgICAgICAgICAgINC/0YDQvtC30YDQsNGH0L3QvtGB0YLRjCAtIDUwJQogICAgICAgICAgICAqLwogICAgfQoKICAgIC5yZWRfdGV4dCAvKiDQvtC/0YDQtdC00LXQu9GP0LXQvCDRgdGC0LjQu9GMINC00LvRjyDQutC70LDRgdGB0LAgInJlZF90ZXh0IiAqLwogICAgewogICAgICAgIGNvbG9yOiByZ2IoMjU1LDAsMCk7CiAgICB9CiAgICAuYmx1ZV90ZXh0ewoKICAgIH0KICAgIC5yZWRfdGV4dCwgLmJsdWVfdGV4dCAvKiDQvtC/0YDQtdC00LXQu9GP0LXQvCDRgdGC0LjQu9GMINC00LvRjyDQtNCy0YPRhSDQutC70LDRgdGB0L7QsiAqLwogICAgewogICAgICAgIHRleHQtc2hhZG93OiA1cHggLTEwcHggMnB4IGJsYWNrOyAvKiDQtNC+0LHQsNCy0LvRj9C10Lwg0YLQtdC60YHRgtGDINGC0LXQvdGMICovCiAgICB9CiAgICA8L3N0eWxlPgoKICAgINCi0YPRgiA8YSBocmVmPSI/Ij7RgdGB0YvQu9C60LAg0L3QsCDRgtC10LrRg9GJ0YPRjiDRgdGC0YDQsNC90LjRhtGDPC9hPi4KICAgINCQINGC0YPRgiDigJQgPHNwYW4gY2xhc3M9InJlZF90ZXh0Ij7QutGA0LDRgdC90YvQuSDRgtC10LrRgdGCPC9zcGFuPi4KICAgINCt0YLQviDigJQgPGEgaHJlZj0iPyIgY2xhc3M9InJlZF90ZXh0Ij7QutGA0LDRgdC90LDRjyDRgdGB0YvQu9C60LAgPC9hPi4KICAgINCX0LTQtdGB0YwgPHNwYW4gc3R5bGU9ImZvbnQtc2l6ZToyZW0iPtCe0L/RgNC10LTQtdC70Y/QtdC8INGB0YLQuNC70Ywg0LLQvdGD0YLQuCDRgtC10LPQsDwvc3Bhbj4uCiAgICA="></iframe>


Стилевых параметров значительное количество. Наиболее адекватно — изучить их здесь__

.. __: http://htmlbook.ru/css/

**Важно** Все размеры в `css` необходимо задавать вместе с размерностью. Иначе результат может быть неправильным.

+------------+----------------------------------------------------------------+
| сокращение |                описание обозначения размерности                |
+============+================================================================+
| `px`       | Размер в пикселях экрана                                       |
+------------+----------------------------------------------------------------+
| `pt`       | Пункт (1/72 дюйма) (обычная величина измерения размера шрифта) |
+------------+----------------------------------------------------------------+
| `pc`       | Пика (`1pc ≡ 12pt`)                                            |
+------------+----------------------------------------------------------------+
| `cm`       | Сантиметры                                                     |
+------------+----------------------------------------------------------------+
| `mm`       | Миллиметры                                                     |
+------------+----------------------------------------------------------------+
| `in`       | Дюймы                                                          |
+------------+----------------------------------------------------------------+
| `%`        | Размер в процентах (зачастую не самыю удобный вид размера)     |
+------------+----------------------------------------------------------------+
| `em`       | Текущий размер шрифта                                          |
+------------+----------------------------------------------------------------+
| `rem`      | Базовый размер шрифта                                          |
+------------+----------------------------------------------------------------+
| `vw`       | Процент ширины окна браузера                                   |
+------------+----------------------------------------------------------------+
| `vh`       | Процент высоты окна браузера                                   |
+------------+----------------------------------------------------------------+

Способы передачи данных между сайтом и браузером рассмотрим на следующей неделе.


Задача
------

#. Разработайте структуру персонального сайта-визитки на flask
#. Создайте сайт на flask и напишите обработчики для, определённых вами, страниц
#. Напишите соответствующие страницы на языке HTML
